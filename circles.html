<!--
Circles!
by Ian Sniffen

This code is super sloppy, maybe I'll eventually fix it

Click for fullscreen
-->
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
      var circles = [];
      var numCircles=0;
      var color = 0;
      function onLoad(){
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
        canvas.addEventListener("click",fullscreen);
        step();
      }
      $(window).resize(function() {
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
        circles=[];
        numCircles=0;
      });
      function fullscreen(){
          var canvas = document.getElementById('canvas');
          if(canvas.webkitRequestFullScreen) canvas.webkitRequestFullScreen();
          else canvas.mozRequestFullScreen();
      }
      function circle(){
        this.x=Math.floor(Math.random()*(window.innerWidth+1));
        this.y=Math.floor(Math.random()*(window.innerHeight+1));
        this.active=true;
        this.inc=true;
        this.hue=color;
        this.satur=Math.floor(Math.random() * 51) + 50;
        this.light=satur=Math.floor(Math.random() * 41) + 30;
        this.color='hsl('+this.hue+','+this.satur+'%,'+this.light+'%)';
        //this.color="hsl("+color+","+satur+"%,100%)";
        this.rad=Math.max(Math.floor(window.innerWidth*.01),Math.floor(window.innerHeight*.01));
        
      }
      function isColliding(ind){
        for(var j=0; j<=numCircles; j++){
          if(j!=ind&&circles[j].active){
            distance=Math.sqrt(Math.pow(circles[ind].x-circles[j].x,2)+Math.pow(circles[ind].y-circles[j].y,2));
            if(distance<=circles[j].rad+circles[ind].rad){
              return true;
            }
          }
        }
        return false;
      }
      function createCircles(){
        circles[numCircles]=new circle();
        if(!isColliding(numCircles))
          numCircles++;
        else circles[numCircles].active=false;
      }
      function drawCircle(x,y,rad){
        ctx.beginPath();
        
      }
      function drawCanvas(){
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        for(var i=0; i<numCircles;i++){
          if(circles[i].active){
              ctx.beginPath();
              var x=circles[i].x;
              var y=circles[i].y;
              var rad=circles[i].rad;
              ctx.arc(x,y,rad,0,2*Math.PI);
              ctx.fillStyle=circles[i].color;
              ctx.fill();
              circles[i].hue+=.5;
              circles[i].color='hsl('+circles[i].hue+','+circles[i].satur+'%,'+circles[i].light+'%)';
          }
        }
      }
      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
      async function step(){
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0,0,canvas.width,canvas.height);
        createCircles();
        //updateCircles();
        drawCanvas();
        if(color<360)
          color+=1;
        else
          color=0;
        await sleep(8.3);
        step();//recursion FOREVER!
      }
      function updateCircles(){
        for(var i=0; i<numCircles;i++){
          if(circles[i].inc){
            circles[i].rad+=Math.max(Math.floor(window.innerWidth*.005),Math.floor(window.innerHeight*.005));
            if(isColliding(i)) circles[i].inc=false;
          }else{
            circles[i].rad-=Math.max(Math.floor(window.innerWidth*.005),Math.floor(window.innerHeight*.005));
            if(circles[i].rad<=Math.max(Math.floor(window.innerWidth*.01),Math.floor(window.innerHeight*.01))){
              
            }
          }  
        }
      }
    </script>
  </head>
  <body onload="onLoad()">
    <canvas id="canvas" width="100%" style="position:absolute">Use a browser with HTML5 canvas support to view this.</canvas>
  </body>
</html>